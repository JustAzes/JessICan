{% extends "template.html" %}
{% block title %}Quiz – Elementtyp deines Pferdes | Tierheilpraxis JessICan{% endblock title %}

{% block description %}
  <meta name="description" content="Interaktives Quiz: Finde heraus, welchem der fünf Elemente (Holz, Feuer, Erde, Metall, Wasser) dein Pferd am ehesten entspricht – inkl. Auswertung.">
  <link rel="preload" href="{{ get_url(path="/img/home-bg_large.jpeg") }}" as="image">
{% endblock description %}

{% block headextras %}
  {# Optional: eigenes Bootstrap fürs Quiz, falls du es unter /static/bootstrap/... ablegst
  <link rel="stylesheet" href="{{ get_url(path='bootstrap/css/bootstrap.min.css') }}">
  #}
  <style>
    .quiz-intro small { opacity: .85; }
    .quiz-card { border: 1px solid rgba(0,0,0,.08); border-radius: .75rem; }
    .quiz-card .card-header { background: #f8f9fa; }
    .answer-img { display: none; max-width: 140px; border-radius: .5rem; }
    .mix-sep { font-weight: 600; }
    .sticky-eval { position: sticky; bottom: 0; z-index: 1030; background: rgba(255,255,255,.98); border-top: 1px solid rgba(0,0,0,.1); }
    .required-hint { font-size:.9rem; opacity:.8; }
    .progress { height: .75rem; }
    .quiz-badge { min-width: 2.25rem; }
  </style>
{% endblock headextras %}

{% block header %}
<header class="masthead" style="background-image: url('{{ get_url(path="/img/home-bg_large.jpeg")}}')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-10 mx-auto">
        <div class="site-heading">
          <h1>Quiz</h1>
          <span class="subheading">19 Fragen zur Ermittlung des Elementes</span>
        </div>
      </div>
    </div>
  </div>
</header>
{% endblock header %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-lg-10 col-md-10 mx-auto">

      <section class="quiz-intro mb-4">
        <p class="lead mb-1">
          Beantworte die Fragen spontan. Am Ende erfährst du, welchem <strong>Element</strong> dein Pferd am ehesten ähnelt – oder ob es ein <strong>Mischtyp</strong> ist.
        </p>
        <small class="text-muted d-block">
          Elemente: <span class="badge badge-secondary quiz-badge">Holz (A)</span>
          <span class="badge badge-danger quiz-badge">Feuer (B)</span>
          <span class="badge badge-warning quiz-badge">Erde (C)</span>
          <span class="badge badge-info quiz-badge">Metall (D)</span>
          <span class="badge badge-primary quiz-badge">Wasser (E)</span>
        </small>

        <div class="mt-3">
          <div class="d-flex align-items-center mb-1">
            <div class="mr-2">Fortschritt</div>
            <div class="flex-grow-1">
              <div class="progress" aria-hidden="true">
                <div id="quizProgress" class="progress-bar" role="progressbar" style="width:0%" aria-valuemin="0" aria-valuemax="19" aria-valuenow="0"></div>
              </div>
            </div>
            <div class="ml-2"><span id="progressText">0</span>/19</div>
          </div>
          <span class="required-hint text-muted">Tipp: Du kannst Fragen überspringen, sie zählen dann einfach nicht mit.</span>
        </div>
      </section>

      <form id="quizForm" novalidate>
        <div id="quizContainer"></div>

        <div class="sticky-eval p-3 mt-4">
          <div class="d-flex align-items-center">
            <button id="evalBtn" type="button" class="btn btn-success btn-lg mr-3">Auswerten</button>
            <div class="text-muted"><span id="answeredCount">0</span> von 19 Fragen beantwortet</div>
            <a href="#resultBox" class="ml-auto btn btn-link">zur Auswertung springen</a>
          </div>
        </div>
      </form>

      <hr class="my-4">

      <section id="resultBox" aria-live="polite" aria-atomic="true">
        <div id="resultAlert" class="alert alert-info d-none" role="alert"></div>
        <div id="resultCard" class="card d-none">
          <div class="card-body">
            <h4 id="resultTitle" class="card-title"></h4>
            <p id="resultText" class="card-text"></p>

            <div class="d-flex align-items-center mt-3">
              <figure class="mr-3 mb-0">
                <img id="resultImg1" class="answer-img" src="" alt="">
              </figure>
              <span class="mix-sep" id="mixPlus" style="display:none;">+</span>
              <figure class="ml-3 mb-0">
                <img id="resultImg2" class="answer-img" src="" alt="">
              </figure>
            </div>

            <div class="mt-4">
              <a href="{{ get_url(path='behandlung/behandlungsmethoden/', trailing_slash=true) }}" class="btn btn-primary mr-2">Mehr zu meinen Methoden</a>
              <a href="{{ get_url(path='contact/', trailing_slash=true) }}" class="btn btn-info">Jetzt Termin vereinbaren</a>
            </div>
          </div>
        </div>
      </section>

      <p class="mt-3 text-muted">
        Hinweis: Dieses Quiz ersetzt keine Diagnose. Es hilft, Tendenzen einzuordnen. Für eine individuelle Einschätzung <a href="{{ get_url(path='contact/', trailing_slash=true) }}">sprechen Sie mich gern an</a>.
      </p>

      {# --- Die Fragen kommen als JSON: --- #}
      <script id="quizData" type="application/json">
      {
        "total": 19,
        "questions": [
          { "q": "Neue Gruppe/Offenstall: Wie zeigt sich dein Pferd beim Umstellen?",
            "a": ["Setzt sich zügig durch, sportlich-dominant", "Lebhaft, neugierig, schnell mittendrin", "Gelassen, freundlich, findet zu jedem Anschluss", "Beobachtet erst, hält Routinen, bleibt korrekt", "Unsicher, rangniedrig, braucht Zeit und Nähe"] },
          { "q": "Verladen/Hänger: Womit rechnest du eher?",
            "a": ["Kurzer Macht-Check – dann geht’s", "Tagesformabhängig – mal super, mal Drama", "Mit Heu/Leckerli klappt’s am schnellsten", "Routine sitzt: rauf, zu, los – fertig", "Allein schwer; mit Kumpel oder vertrautem Hänger ok"] },
          { "q": "Training, das am meisten Spaß macht:",
            "a": ["Sport und Tempo, gern Herausforderungen", "Abwechslung, Spiel, Zirkus, Clicker", "Ruhige Gymnastik plus lange Ausritte", "Strukturierter Plan, präzises Arbeiten", "Spontan, abhängig von Stimmung/Umfeld"] },
          { "q": "Pflege/Herausputzen vor einem Ereignis:",
            "a": ["Kräftiges Massieren top – aber nicht zu lang", "Genießt Styling und Glitzer, ein bisschen eitel", "Lange putzen okay – danach gern mal wälzen", "Nur das Nötigste; Funktion vor Glamour", "In ruhiger Ecke geduldig – Waschen ungern"] },
          { "q": "Urlaubsvertretung übernimmt:",
            "a": ["Testet neue Reiter – klare Führung hilft", "Mag freundliche, spielerische Menschen", "Kommt mit fast allen zurecht, Hauptsache nett", "Am besten feste Bezugspersonen mit Routine", "Nur vertraute Leute; Fremde verunsichern"] },
          { "q": "Kurzcharakter:",
            "a": ["Sportlicher Anpacker, führungsstark", "Elegant, lebensfroh, manchmal überdreht", "Gemütlich, friedliebend, futtermotiviert", "Klar, korrekt, detailgenau", "Vorsichtig, sensibel, loyal"] },
          { "q": "Neues Abenteuer (Trail, Umgebung, Kurs):",
            "a": ["Blüht auf, will loslegen", "Aufgeregt, spritzig – liebt den Trubel", "Sucht Harmonie und Begleitung", "Checkt die Lage ruhig und sachlich", "Zieht Rückzug/Heimat vor"] },
          { "q": "Im Mittelpunkt/Publikum:",
            "a": ["Nimmt die Challenge an", "Genießt die Show, wird albern", "Manchmal Patzer trotz Können", "Arbeitet nüchtern weiter", "Verweigert eher"] },
          { "q": "Wenn dein Alltag sich ändert, ist dein Pferd eher:",
            "a": ["Ungeduldig, drängelt", "Hibbelig und verspielt", "Anhänglich, sucht Nähe", "Distanziert, kontrolliert", "Äußerlich ruhig, innerlich angespannt"] },
          { "q": "Lernstil, der am besten funktioniert:",
            "a": ["Kurze, klare Ansagen und machen", "Über Spiel und Motivation", "Rituale und Wiederholung", "Präzise Erklärungen und Kriterien", "In eigenem Tempo herausfinden"] },
          { "q": "Bei Angst/Stress reagiert es eher mit:",
            "a": ["Gegenwehr/Impuls", "Hysterie/Albernheit", "Kuscheln/Ansprache suchen", "Vorsicht/Überempfindlichkeit", "Rückzug/Unsichtbar werden"] },
          { "q": "Neue Menschen kennenlernen:",
            "a": ["Gern offensiv – kann einschüchtern", "Aufgeregt neugierig oder schüchtern", "Freundlich und verbindend", "Höflich, aber reserviert", "Misstrauisch, braucht Zeit"] },
          { "q": "Fressen/Futterfokus:",
            "a": ["Behält Konkurrenz im Blick", "Lässt Futter für Action liegen", "Vergisst alles außer Fressen", "Pickt selektiv das Beste", "Frisst, weil es muss"] },
          { "q": "Größter innerer Antreiber:",
            "a": ["Action und Ziele", "Spiel und Spaß", "Harmonie und Miteinander", "Ordnung und Klarheit", "Ruhe und Sicherheit"] },
          { "q": "Geräusche/Wetter (Wind, Planen, knisternde Halle):",
            "a": ["Stört kaum – weiter geht’s", "Findet’s aufregend, wird spritzig", "Mit Begleitung ok", "Akzeptiert nach kurzer Gewöhnung", "Mag es gar nicht, lieber weg"] },
          { "q": "Belohnung, die am besten wirkt:",
            "a": ["Vorwärts gehen dürfen/Aufgabe lösen", "Loben/Spiel/kurzer Fun-Moment", "Futter und ruhige Pause", "Präzises Timing/klare Auflösung", "Zeit/Distanz und Sicherheit"] },
          { "q": "Rolle, die am ehesten passt:",
            "a": ["Der Organisator/Anführer", "Der Spielkamerad", "Der Sympathieträger", "Der Beobachter/Perfektionist", "Der Philosoph"] },
          { "q": "Regeneration nach Anstrengung/Krankheit:",
            "a": ["Schnell wieder einsatzbereit", "Will früh wieder mitmischen", "Braucht Komfort und Futtermanagement", "Strikten Wiederaufbauplan bevorzugt", "Benötigt viel Ruhe und Schutz"] },
          { "q": "Berührung/Kontakt:",
            "a": ["Kräftige Massage, aktivierend", "Sanft streicheln, positive Energie", "Ganz viel Nähe und Kuscheln", "Nur gezielt/zweckmäßig", "Kommt von selbst, wenn bereit"] }
        ]
      }
      </script>

    </div>
  </div>
</div>
{% endblock content %}

{% block extrascripts %}
  {# Optional: volles Bootstrap-Bundle (falls eingebunden)
  <script src="{{ get_url(path='bootstrap/js/bootstrap.bundle.min.js') }}" defer></script>
  #}

  <script>
    (function() {
      var dataEl = document.getElementById('quizData');
      var cfg = JSON.parse(dataEl.textContent);
      var TOTAL = cfg.total || (cfg.questions ? cfg.questions.length : 0);
      var container = document.getElementById('quizContainer');
      var form = document.getElementById('quizForm');

      var letters = ['A','B','C','D','E'];
      var letterToElement = { 'A':'Holz','B':'Feuer','C':'Erde','D':'Metall','E':'Wasser' };
      var elementOrder = ['Holz','Feuer','Erde','Metall','Wasser'];

      // Render Fragen
      cfg.questions.forEach(function(q, idx){
        var card = document.createElement('div');
        card.className = 'card quiz-card mb-3';
        card.id = 'card-q' + (idx+1);

        var head = document.createElement('div');
        head.className = 'card-header';
        head.innerHTML = '<h5 class="mb-0">Frage ' + (idx+1) + '</h5>';

        var body = document.createElement('div');
        body.className = 'card-body';
        var p = document.createElement('p');
        p.className = 'mb-3';
        p.textContent = q.q;
        body.appendChild(p);

        q.a.forEach(function(text, i){
          var val = letters[i];
          var wrap = document.createElement('div');
          wrap.className = 'custom-control custom-radio mb-2';
          var input = document.createElement('input');
          input.type = 'radio';
          input.className = 'custom-control-input quiz-input';
          input.name = 'q' + (idx+1);
          input.id = 'q' + (idx+1) + '_' + val;
          input.value = val;

          var label = document.createElement('label');
          label.className = 'custom-control-label';
          label.setAttribute('for', input.id);
          label.textContent = text + ' (' + val + ')';

          wrap.appendChild(input);
          wrap.appendChild(label);
          body.appendChild(wrap);
        });

        card.appendChild(head);
        card.appendChild(body);
        container.appendChild(card);
      });

      // UI Elemente
      var inputs = Array.prototype.slice.call(document.querySelectorAll('.quiz-input'));
      var progressBar = document.getElementById('quizProgress');
      var progressText = document.getElementById('progressText');
      var answeredCountEl = document.getElementById('answeredCount');
      var evalBtn = document.getElementById('evalBtn');
      var resultAlert = document.getElementById('resultAlert');
      var resultCard = document.getElementById('resultCard');
      var resultTitle = document.getElementById('resultTitle');
      var resultText = document.getElementById('resultText');
      var img1 = document.getElementById('resultImg1');
      var img2 = document.getElementById('resultImg2');
      var mixPlus = document.getElementById('mixPlus');

      var singleText = {
        'Holz': 'Holz-Typ: athletisch, zielstrebig, manchmal stur – liebt klare Aufgaben und Bewegung. Biete Herausforderungen und strukturiertes Vorwärts, dann entfaltet es seine Stärke.',
        'Feuer': 'Feuer-Typ: charmant, lebhaft, sensibel – genießt Aufmerksamkeit und Abwechslung. Mit spielerischem Training und positiver Energie bleibt es motiviert.',
        'Erde': 'Erde-Typ: freundlich, ausgeglichen, verlässlich – Harmonie und Futtermanagement sind Gold wert. Mit ruhiger Arbeit und Nähe glänzt es in Beständigkeit.',
        'Metall': 'Metall-Typ: präzise, korrekt, ritualtreu – liebt klare Kriterien und Ordnung. Mit nachvollziehbaren Plänen und feinem Timing lernt es exzellent.',
        'Wasser': 'Wasser-Typ: vorsichtig, feinfühlig, loyal – Sicherheit und Zeit sind zentral. Mit Schutzraum und geduldigem Aufbau wächst das Vertrauen nachhaltig.'
      };

      var mixText = {
        'Holz+Feuer': 'Mischtyp Holz-Feuer: leistungsbereit und lebensfroh. Fordere zielgerichtet und halte die Motivation hoch – Tempo mit Spaß ist der Schlüssel.',
        'Holz+Erde': 'Mischtyp Holz-Erde: tatkräftig mit ruhigem Kern. Wechsle zwischen fordernden Aufgaben und wohligen Pausen – Balance bringt Bestleistung.',
        'Holz+Metall': 'Mischtyp Holz-Metall: Antrieb trifft Präzision. Klare Ziele plus saubere Kriterien – so wird Power kontrollierte Qualität.',
        'Holz+Wasser': 'Mischtyp Holz-Wasser: mutig, aber sensibel für Rahmenbedingungen. Struktur gibt Sicherheit, dann kann die Energie sicher nach vorn gehen.',
        'Feuer+Erde': 'Mischtyp Feuer-Erde: verspielt und menschenbezogen, sucht Harmonie. Kurze Fun-Einheiten und verlässliche Routinen – Wohlfühlen hält die Flamme am Leuchten.',
        'Feuer+Metall': 'Mischtyp Feuer-Metall: Showtalent mit Sinn für Form. Abwechslung ja – aber sauber gerahmt, dann bleibt die Energie fokussiert.',
        'Feuer+Wasser': 'Mischtyp Feuer-Wasser: zwischen Euphorie und Vorsicht. Erst Sicherheit schaffen, dann spielerisch steigern – so funkt es ohne Überforderung.',
        'Erde+Metall': 'Mischtyp Erde-Metall: verbindlich und ordentlich. Beständige Arbeit mit klaren Schritten – Wohlgefühl und Qualität wachsen Hand in Hand.',
        'Erde+Wasser': 'Mischtyp Erde-Wasser: sanft, nähebedürftig, sensibel. Sanfte Rituale, Schutz und gutes Management – Vertrauen ist die Basis.',
        'Metall+Wasser': 'Mischtyp Metall-Wasser: kontrolliert und wachsam. Transparente Regeln und ruhige Umgebung – so entsteht tiefe Gelassenheit.'
      };

      function countAnswered() {
        // frisch ermitteln (weil wir dynamisch gerendert haben)
        inputs = Array.prototype.slice.call(document.querySelectorAll('.quiz-input'));
        var names = new Set(inputs.map(function(i){return i.name;}));
        var answered = 0;
        names.forEach(function(n) {
          if (form.querySelector('input[name="'+n+'"]:checked')) answered++;
        });
        progressBar.style.width = (answered / TOTAL * 100) + '%';
        progressBar.setAttribute('aria-valuenow', answered);
        progressText.textContent = answered;
        answeredCountEl.textContent = answered;
      }

      // Events
      document.addEventListener('change', function(e){
        if (e.target.classList && e.target.classList.contains('quiz-input')) countAnswered();
      });

      function evaluate() {
        var counts = { 'Holz':0, 'Feuer':0, 'Erde':0, 'Metall':0, 'Wasser':0 };
        var names = new Set(Array.prototype.slice.call(document.querySelectorAll('.quiz-input')).map(function(i){return i.name;}));
        names.forEach(function(n){
          var checked = form.querySelector('input[name="'+n+'"]:checked');
          if (checked) {
            var el = letterToElement[checked.value];
            counts[el] = (counts[el]||0)+1;
          }
        });

        var answered = Object.values(counts).reduce(function(a,b){return a+b;},0);
        var resultAlert = document.getElementById('resultAlert');
        var resultCard  = document.getElementById('resultCard');
        var resultTitle = document.getElementById('resultTitle');
        var resultText  = document.getElementById('resultText');
        var img1 = document.getElementById('resultImg1');
        var img2 = document.getElementById('resultImg2');
        var mixPlus = document.getElementById('mixPlus');

        if (answered === 0) {
          resultAlert.classList.remove('d-none','alert-success','alert-warning');
          resultAlert.classList.add('alert-info');
          resultAlert.textContent = 'Bitte beantworte mindestens eine Frage, um eine Tendenz zu erhalten.';
          resultCard.classList.add('d-none');
          document.getElementById('card-q1').scrollIntoView({behavior:'smooth', block:'start'});
          return;
        }

        var max = Math.max.apply(null, Object.values(counts));
        var tops = elementOrder.filter(function(k){ return counts[k] === max && max > 0; });

        resultAlert.classList.add('d-none');
        resultCard.classList.remove('d-none');
        img1.style.display = 'none'; img2.style.display = 'none'; mixPlus.style.display = 'none';
        img1.src = ''; img2.src = ''; img1.alt = ''; img2.alt = '';

        if (tops.length === 1) {
          var el = tops[0];
          resultTitle.textContent = 'Ihr Pferd ähnelt dem Element: ' + el;
          resultText.textContent = singleText[el] + ' – Sie möchten mehr dazu erfahren? Sprechen Sie mich gern an.';
          img1.src = "{{ get_url(path='img/quiz') }}/" + el.toLowerCase() + ".jpg";
          img1.alt = 'Symbolbild Element ' + el;
          img1.style.display = 'block';
        } else {
          var sorted = tops.slice().sort(function(a,b){
            return elementOrder.indexOf(a) - elementOrder.indexOf(b);
          });
          var title = 'Mischtyp: ' + sorted.join(' + ');
          resultTitle.textContent = title;

          if (sorted.length === 2) {
            var key = sorted[0] + '+' + sorted[1];
            resultText.textContent = (mixText[key] || 'Ihr Pferd vereint zwei Elemente ausgewogen. Struktur und Sicherheit helfen, die Stärken optimal zu nutzen.') + ' – Sprechen Sie mich gern an.';
          } else {
            resultText.textContent = 'Ihr Pferd vereint mehrere Elemente (' + sorted.join(', ') + '). Mit einem individuell abgestimmten Plan lassen sich diese Stärken gezielt nutzen. – Sprechen Sie mich gern an.';
          }

          img1.src = "{{ get_url(path='img/quiz') }}/" + sorted[0].toLowerCase() + ".jpg";
          img1.alt = 'Symbolbild Element ' + sorted[0];
          img1.style.display = 'block';

          if (sorted.length >= 2) {
            img2.src = "{{ get_url(path='img/quiz') }}/" + sorted[1].toLowerCase() + ".jpg";
            img2.alt = 'Symbolbild Element ' + sorted[1];
            mixPlus.style.display = 'inline-block';
            img2.style.display = 'block';
          }
        }

        document.getElementById('resultBox').scrollIntoView({behavior:'smooth', block:'start'});
      }

      var evalBtn = document.getElementById('evalBtn');
      evalBtn.addEventListener('click', evaluate);
      countAnswered();
    })();
  </script>
{% endblock extrasripts %}
